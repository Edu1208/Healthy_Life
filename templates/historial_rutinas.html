# Modifica la ruta existente en app.py
@app.route('/historial-rutinas-data')
def historial_rutinas_data():
    if 'user_id' not in session:
        return jsonify({'success': False, 'message': 'No autorizado'}), 401
    
    id_rutina = request.args.get('id')
    
    try:
        if id_rutina:
            # Si hay un ID espec√≠fico, devolver solo esa rutina
            rutina = mongo.db.rutinas.find_one({
                '_id': ObjectId(id_rutina),
                'user_id': session['user_id']
            })
            
            if rutina:
                rutina['_id'] = str(rutina['_id'])
                return jsonify({'success': True, 'rutinas': [rutina]})
            else:
                return jsonify({'success': False, 'message': 'Rutina no encontrada'}), 404
        else:
            # Si no hay ID, devolver todas las rutinas
            rutinas_cursor = mongo.db.rutinas.find({
                'user_id': session['user_id']
            }).sort('fecha_creacion', -1)
            
            rutinas = []
            for rutina in rutinas_cursor:
                rutina['_id'] = str(rutina['_id'])
                rutinas.append(rutina)
            
            return jsonify({'success': True, 'rutinas': rutinas})
    except Exception as e:
        return jsonify({'success': False, 'message': str(e)}), 500
